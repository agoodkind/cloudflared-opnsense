#!/bin/sh
# Post-installation script for os-cloudflared

log() {
    echo "[os-cloudflared] $*"
}

log "Installing cloudflared plugin for OPNsense"

# Ensure required directories exist
mkdir -p /usr/local/etc/cloudflared
mkdir -p /var/log/cloudflared

# Set proper permissions
chmod 755 /usr/local/etc/cloudflared
chmod 755 /var/log/cloudflared

# Reload configd templates
log "Reloading OPNsense configuration templates"
if [ -x /usr/local/etc/rc.configure_plugins ]; then
    /usr/local/etc/rc.configure_plugins
fi

log "Installation complete"
log "Configure cloudflared at: Services > Cloudflared"
log "Restart configd to activate: /usr/local/etc/rc.d/configd restart"

exit 0